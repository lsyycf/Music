<h1 align="center">🎵 本地音乐播放器</h1>

<div align="center">

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![Pygame](https://img.shields.io/badge/Pygame-2.0+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Platform](https://img.shields.io/badge/Platform-Windows-lightgrey.svg)

*一个基于 Pygame 开发的本地音乐播放器*

**🤖 本项目由 AI 全程开发完成 | 仅供个人使用**

</div>

---

## 📖 项目简介

这是一款本地音乐播放器，提供简洁美观的界面和丰富的功能。支持多种音频格式播放，具备播放列表管理、音乐元数据编辑、手机同步等实用功能。

### ✨ 核心特性

- 🎨 **美观界面** - 现代化深色主题界面
- 🎵 **多格式支持** - 支持 FLAC、MP3、WAV、OGG、M4A 等主流音频格式
- 📝 **播放列表管理** - 支持随机/顺序播放模式，自动保存播放进度
- 🎚️ **完整播放控制** - 播放/暂停、上一首/下一首、快进/快退、进度拖动
- 🔊 **音量管理** - 独立音量控制和静音功能
- 📱 **手机同步** - 通过 ADB 将音乐同步到 Android 手机
- 💾 **状态持久化** - 自动保存播放位置、音量、播放列表等状态
- 🏷️ **元数据处理** - 自动根据文件名提取艺术家和标题信息

---

## 🖼️ 功能展示

### 主要功能

- **音乐播放控制**
  - 播放/暂停
  - 上一首/下一首
  - 快进 10 秒 / 快退 10 秒
  - 可拖动进度条
  
- **播放模式**
  - 随机播放
  - 顺序播放
  - 自动切换下一首

- **文件管理**
  - 浏览选择本地音乐文件夹
  - 自动扫描支持的音频文件
  - 实时检测文件夹变化

- **手机同步**
  - 通过 ADB 连接 Android 设备
  - 智能增量同步
  - 自动更新手机音乐元数据

---

## 🛠️ 技术栈

- **GUI 框架**: Pygame
- **音频播放**: Pygame Mixer
- **元数据处理**: Mutagen
- **文件操作**: win32file (pywin32)
- **进程管理**: subprocess
- **打包工具**: PyInstaller

---

## 📦 安装与运行

### 方式一：直接运行可执行文件

1. 下载 `dist/网易云音乐.exe`
2. 双击运行即可

### 方式二：从源码运行

#### 环境要求

- Python 3.10 或更高版本
- Windows 操作系统

#### 安装依赖

```bash
# 克隆或下载项目
git clone https://github.com/lsyycf/Music.git

# 进入项目目录
cd "C:\Program Files\Music"

# 安装依赖包
pip install -r requirements.txt
```

#### 运行程序

```bash
python main.py
```

---

## 📚 使用指南

### 基本操作

1. **选择音乐文件夹**
   - 点击"浏览"按钮选择包含音乐文件的文件夹
   - 程序会自动扫描支持的音频文件

2. **播放音乐**
   - 点击"播放"按钮开始播放
   - 使用"上首"/"下首"切换歌曲
   - 使用"快退"/"快进"调整播放位置
   - 拖动进度条快速定位

3. **调整音量**
   - 拖动音量滑块调整音量大小
   - 点击"静音"快速静音/恢复

4. **切换播放模式**
   - 点击"随机"/"顺序"按钮切换播放模式
   - 随机模式：随机打乱歌曲顺序
   - 顺序模式：按文件名排序播放

5. **重置播放器**
   - 点击"重置"按钮清除当前文件夹和播放列表
   - 重新开始选择音乐文件夹

### 手机同步功能

#### 前置要求

1. 安装 Android Debug Bridge (ADB)
   - 下载 Android Platform Tools
   - 将 ADB 添加到系统环境变量

2. 启用手机 USB 调试
   - 进入手机设置 → 关于手机 → 连续点击版本号 7 次启用开发者选项
   - 进入开发者选项 → 启用 USB 调试
   - 使用 USB 线连接手机到电脑

#### 使用步骤

1. 连接手机并确保 ADB 连接成功
   ```bash
   adb devices  # 应该能看到你的设备
   ```

2. 在播放器中点击"同步"按钮

3. 首次同步时输入手机音乐文件夹路径
   - 格式示例：`/sdcard/Music`
   - 或使用 Windows 风格路径，程序会自动转换

4. 程序将自动完成以下操作：
   - 删除手机中已不存在于电脑的音乐文件
   - 上传电脑中新增的音乐文件
   - 更新音乐元数据和修改时间
   - 触发手机媒体扫描

---

## 🗂️ 项目结构

```
Music/
├── main.py                 # 主程序入口
├── config.py               # 配置文件和数据持久化
├── gui_components.py       # GUI 组件（按钮、滑块、输入框等）
├── music_utils.py          # 音乐文件处理工具函数
├── phone_sync.py           # 手机同步功能实现
├── init.py                 # 音乐元数据初始化处理
├── outline.png             # 应用图标
├── 网易云音乐.spec          # PyInstaller 打包配置
├── dist/                   # 打包输出目录
    └── 网易云音乐.exe       # 可执行文件
```

---

## 🔧 打包说明

### 使用 PyInstaller 打包

#### 安装 PyInstaller

```bash
pip install pyinstaller
```

#### 打包命令

```bash
pyinstaller 网易云音乐.spec
```

#### 打包配置说明

`网易云音乐.spec` 文件配置了以下选项：

- **入口文件**: `main.py`
- **数据文件**: `outline.png` (应用图标)
- **打包模式**: 单文件模式（所有依赖打包成一个 exe）
- **控制台窗口**: 关闭（`console=False`）
- **UPX 压缩**: 启用（减小文件体积）
- **应用图标**: `outline.png`

#### 打包后文件位置

打包完成后，可执行文件位于：
```
dist/网易云音乐.exe
```

#### 注意事项

- 打包后的程序包含所有必要的依赖，无需安装 Python 环境即可运行
- 首次运行可能需要较长时间解压依赖文件
- 如需修改图标，替换 `outline.png` 并重新打包即可

---

## ⚙️ 配置文件

程序配置和播放状态保存在用户目录下的 `settings.json` 文件中：

```
Windows: C:\Users\<用户名>\settings.json
```

### 配置文件内容

```
{
    "global_volume": 1.0,               # 全局音量 (0.0-1.0)
    "last_active_folder": "...",        # 上次使用的音乐文件夹
    "next_new_playlist_mode": "random", # 播放模式 (random/sequential)
    "playlists": {                      # 各文件夹的播放列表状态
        "文件夹路径": {
            "song_list": ["..."],       # 歌曲列表
            "last_index": 0,            # 上次播放的歌曲索引
            "last_position": 0.0,       # 上次播放的位置（秒）
            "play_mode": "random"       # 该文件夹的播放模式
        }
    },
    "phone_mappings": {                 # 手机同步路径映射
        "电脑路径": "手机路径"
    }
}
```

---

## 🎯 功能详解

### 音乐元数据处理

程序会自动处理音乐文件的元数据：

1. **从文件名提取信息**
   - 文件名格式：`艺术家-歌曲名.mp3`
   - 自动提取艺术家和歌曲名写入元数据

2. **清理无用标签**
   - 自动删除：副标题、描述、专辑艺术家、专辑、流派、音轨号等

3. **修改文件时间**
   - 将所有音乐文件的时间戳统一修改为当天 00:00:00
   - 便于按时间排序管理

### 播放列表智能管理

- **增量更新**：切换文件夹时自动检测文件变化
  - 新增的歌曲随机插入当前播放位置之后
  - 删除的歌曲自动从播放列表移除
  - 保持当前正在播放的歌曲不变

- **状态保存**：每个文件夹独立保存
  - 播放位置精确到秒
  - 播放列表顺序
  - 当前歌曲索引

---

## 🎨 界面配色方案

### 主题色彩

| 元素 | 颜色值 | 说明 |
|------|--------|------|
| 背景色 | `(18, 18, 28)` | 深蓝黑色 |
| 文字色 | `(230, 230, 240)` | 浅灰白色 |
| 强调色 | `(99, 102, 241)` | 蓝紫色 |
| 按钮色 | `(37, 37, 56)` | 深灰蓝色 |
| 悬停色 | `(55, 55, 85)` | 中灰蓝色 |

---

## 🔍 常见问题

### Q: 为什么有些音频文件无法播放？

**A**: 请确保文件格式为支持的格式（FLAC、MP3、WAV、OGG、M4A），且文件未损坏。

### Q: 手机同步失败怎么办？

**A**: 
1. 检查是否正确安装 ADB 并添加到环境变量
2. 确认手机已启用 USB 调试
3. 运行 `adb devices` 确认设备连接
4. 尝试重新连接手机或重启 ADB 服务：`adb kill-server && adb start-server`

### Q: 播放进度没有保存？

**A**: 程序在正常退出时会自动保存播放状态。如果程序异常关闭，最后的播放进度可能丢失。

### Q: 如何重新设置手机同步路径？

**A**: 点击"重置"按钮（手机路径旁边），然后重新点击"同步"按钮输入新路径。

### Q: 修改了元数据后在其他播放器中不显示？

**A**: 某些播放器可能有缓存，尝试清除播放器缓存或重新扫描媒体库。

---

## 📝 开发说明

### 支持的音频格式

定义在 `config.py` 中的 `SUPPORTED_FORMATS`：
```python
SUPPORTED_FORMATS = (".flac", ".mp3", ".wav", ".ogg", ".m4a")
```

### 关键配置参数

```python
SCREEN_WIDTH = 600                    # 窗口宽度
SCREEN_HEIGHT = 520                   # 窗口高度
FAST_FORWARD_REWIND_STEP = 10         # 快进/快退步长（秒）
SCROLL_DELAY_DURATION = 2000          # 文字滚动延迟（毫秒）
MAX_WORKERS = 8                       # 手机同步并发数
```

---

## 🤝 贡献与反馈

本项目完全由 AI 开发，仅供个人学习使用。

如有问题或建议，欢迎提出 Issue 或 Pull Request。

---

## ⚠️ 免责声明

- 本项目仅供个人学习和研究使用
- 请勿用于任何商业用途
- 使用本软件产生的任何后果由使用者自行承担
- 本项目与网易云音乐官方无任何关联

---

## 🙏 致谢

- **Pygame** - 提供了出色的游戏和多媒体开发框架
- **Mutagen** - 强大的音频元数据处理库
- **PyInstaller** - 方便的 Python 打包工具
- **AI Technology** - 本项目完全由 AI 辅助开发完成

---

<div align="center">

**🎵 享受你的音乐时光！**

Made with ❤️ by AI | 2025

</div>

